{"metadata":{"id":"5719eb9a-b2aa-43ee-9260-38192337ce09","name":"projet","user_save_timestamp":"1970-01-01T00:00:00.000Z","auto_save_timestamp":"1970-01-01T00:00:00.000Z","language_info":{"name":"scala","file_extension":"scala","codemirror_mode":"text/x-scala"},"trusted":true,"sparkNotebook":null,"customLocalRepo":null,"customRepos":null,"customDeps":null,"customImports":null,"customArgs":null,"customSparkConf":null,"customVars":null},"cells":[{"metadata":{"id":"EC6273539C974E8F8A8F7D7B64991038"},"cell_type":"markdown","source":"# Analysing crimes record in Chicago with Scala and Spark\n\n#### Data \nhttps://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2/data\n"},{"metadata":{"id":"016780AD8B2C4EA493A242267AA7FCD6"},"cell_type":"markdown","source":"### Importing `Spark` and `notebook` modules"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"D3AD79CE488248CA8AD132316AE21B5C"},"cell_type":"code","source":"import org.apache.spark._\nimport notebook._\n","outputs":[{"name":"stdout","output_type":"stream","text":"import org.apache.spark._\nimport notebook._\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":1,"time":"Took: 1.813s, at 2019-01-17 17:23"}]},{"metadata":{"id":"2FDC954BC4AF43599484D5BE8A3D9753"},"cell_type":"markdown","source":"### Extract the most dangerous wards in Chicago by analysing the number of crimes in each ward"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"56B069F02FFE45B286B71FA1F36E72E3"},"cell_type":"code","source":"object CrimeAnalyserByWards {\n  def CrimesByWards() :org.apache.spark.sql.DataFrame = {\n    \n    val session = SparkSession.builder().appName(\"Crime analyser by ward 1\").master(\"local\").getOrCreate()\n    val data1 = session.read.format(\"csv\").option(\"header\", \"true\").load(\"/crimes.csv\")\n    val data = data1.na.drop()\n    \n    val wards = data.select(\"Ward\").rdd\n    \n    val mostDangerousWards = wards.map{ case ward => (ward(0).toString(), 1) }.reduceByKey(_ + _).sortBy(-_._2)\n      .toDF(\"Ward\", \"Crimes\")\n                                                                                         \n    val locations: Map[String, (Double, Double)] = Map()\n    \n    val columnNames = Seq(\"Ward\", \"Latitude\", \"Longitude\")\n    val wardLongLat = data.select(columnNames.head, columnNames.tail: _*).rdd\n    \n    val wardLongLatReduce = wardLongLat\n        .map{row => (row.getString(0), (row.getString(1).toDouble, row.getString(2).toDouble))}\n        .reduceByKey((a, b) => ( (a._1+ b._1)/2 , (a._2 + b._2)/2))\n    \n    val listWard = wardLongLatReduce.map(row => row._1)\n    val listLong = wardLongLatReduce.map(row => row._2._1)\n    val listLat = wardLongLatReduce.map(row => row._2._2)\n    \n    val listLatLong = listLat.zip(listLong).toDF(\"Latitude\", \"Longitude\")\n    val listLatWard = listLat.zip(listWard).toDF(\"Latitude\", \"Ward\")\n    \n    val result = listLatLong.join(listLatWard, Seq(\"Latitude\"), \"inner\")\n    \n    val finalResult = result.join(mostDangerousWards, Seq(\"Ward\"), \"inner\")\n    \n    return finalResult\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"defined object CrimeAnalyserByWards\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":2,"time":"Took: 2.840s, at 2019-01-15 15:23"}]},{"metadata":{"id":"E0D50A34AFF04D058E4200173A009B56"},"cell_type":"markdown","source":"### Plot a geographic chart to demonstrate the danger degree in each ward on the map of Chicago City"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"presentation":{"pivot_chart_state":"{\n  \"hiddenAttributes\": [],\n  \"menuLimit\": 200,\n  \"cols\": [],\n  \"rows\": [\n    \"Hour\",\n    \"Crimes\"\n  ],\n  \"vals\": [\n    \"Crimes\"\n  ],\n  \"exclusions\": {},\n  \"inclusions\": {},\n  \"unusedAttrsVertical\": 85,\n  \"autoSortUnusedAttrs\": false,\n  \"inclusionsInfo\": {},\n  \"aggregatorName\": \"List Unique Values\",\n  \"rendererName\": \"Col Heatmap\"\n}"},"id":"1C2BD4F31B3A4470987A507AF1D1C797"},"cell_type":"code","source":"val proccessedData1 = CrimeAnalyserByWards.CrimesByWards()\n// proccessedData1.show()\nval chart1 = GeoPointsChart(proccessedData1, latLonFields = Some((\"Longitude\", \"Latitude\")),\n                       rField = Some(\"Crimes\"), colorField = Some(\"Crimes\"), sizes = (1000, 1000))\nchart1\n","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData1: org.apache.spark.sql.DataFrame = [Ward: string, Latitude: double ... 2 more fields]\nchart1: notebook.front.widgets.charts.GeoPointsChart[org.apache.spark.sql.DataFrame] = <GeoPointsChart widget>\nres3: notebook.front.widgets.charts.GeoPointsChart[org.apache.spark.sql.DataFrame] = <GeoPointsChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anond537e5bd316a541d75f7b19af3a95d6e&quot;,&quot;dataInit&quot;:[{&quot;Latitude&quot;:-87.56453668320651,&quot;Longitude&quot;:41.75014180040756,&quot;Crimes&quot;:16},{&quot;Latitude&quot;:-87.68475851148634,&quot;Longitude&quot;:41.77903703337695,&quot;Crimes&quot;:11},{&quot;Latitude&quot;:-87.6519451848125,&quot;Longitude&quot;:41.835468491,&quot;Crimes&quot;:5},{&quot;Latitude&quot;:-87.77614982086718,&quot;Longitude&quot;:41.907497110945314,&quot;Crimes&quot;:8},{&quot;Latitude&quot;:-87.62633448901667,&quot;Longitude&quot;:41.88300227461259,&quot;Crimes&quot;:34},{&quot;Latitude&quot;:-87.63178164921766,&quot;Longitude&quot;:41.82173551464429,&quot;Crimes&quot;:15},{&quot;Latitude&quot;:-87.73345551290821,&quot;Longitude&quot;:41.925012302811524,&quot;Crimes&quot;:11},{&quot;Latitude&quot;:-87.63494081488653,&quot;Longitude&quot;:41.69423915152203,&quot;Crimes&quot;:16},{&quot;Latitude&quot;:-87.58598233033496,&quot;Longitude&quot;:41.753612740927366,&quot;Crimes&quot;:15},{&quot;Latitude&quot;:-87.71370687675,&quot;Longitude&quot;:41.845973098375,&quot;Crimes&quot;:4},{&quot;Latitude&quot;:-87.73618212717949,&quot;Longitude&quot;:41.88066165686897,&quot;Crimes&quot;:30},{&quot;Latitude&quot;:-87.66969111469044,&quot;Longitude&quot;:41.793833073334966,&quot;Crimes&quot;:12},{&quot;Latitude&quot;:-87.70814471176564,&quot;Longitude&quot;:41.92060327271875,&quot;Crimes&quot;:7},{&quot;Latitude&quot;:-87.68525498225,&quot;Longitude&quot;:41.9494300625,&quot;Crimes&quot;:4},{&quot;Latitude&quot;:-87.64514571942186,&quot;Longitude&quot;:41.91574035700781,&quot;Crimes&quot;:8},{&quot;Latitude&quot;:-87.58583683395312,&quot;Longitude&quot;:41.77864948104443,&quot;Crimes&quot;:13},{&quot;Latitude&quot;:-87.733972693,&quot;Longitude&quot;:41.928164333249995,&quot;Crimes&quot;:3},{&quot;Latitude&quot;:-87.69779338301953,&quot;Longitude&quot;:41.75838241339844,&quot;Crimes&quot;:9},{&quot;Latitude&quot;:-87.6603911869963,&quot;Longitude&quot;:41.88894326770408,&quot;Crimes&quot;:20},{&quot;Latitude&quot;:-87.65569193505746,&quot;Longitude&quot;:41.76082353653534,&quot;Crimes&quot;:17},{&quot;Latitude&quot;:-87.70496998075001,&quot;Longitude&quot;:41.90561630175,&quot;Crimes&quot;:3},{&quot;Latitude&quot;:-87.65944443424999,&quot;Longitude&quot;:41.96191796325,&quot;Crimes&quot;:3},{&quot;Latitude&quot;:-87.6112209338954,&quot;Longitude&quot;:41.745752904483574,&quot;Crimes&quot;:20},{&quot;Latitude&quot;:-87.6810974,&quot;Longitude&quot;:41.729619137,&quot;Crimes&quot;:1},{&quot;Latitude&quot;:-87.77462624018358,&quot;Longitude&quot;:41.793877223558596,&quot;Crimes&quot;:9},{&quot;Latitude&quot;:-87.84696890512501,&quot;Longitude&quot;:41.979417372374996,&quot;Crimes&quot;:4},{&quot;Latitude&quot;:-87.75846736089062,&quot;Longitude&quot;:41.949212111648436,&quot;Crimes&quot;:8},{&quot;Latitude&quot;:-87.66571183,&quot;Longitude&quot;:42.004740764,&quot;Crimes&quot;:1},{&quot;Latitude&quot;:-87.66042616179688,&quot;Longitude&quot;:41.854606053546874,&quot;Crimes&quot;:7},{&quot;Latitude&quot;:-87.65026263499999,&quot;Longitude&quot;:41.943510321,&quot;Crimes&quot;:2},{&quot;Latitude&quot;:-87.70636368550001,&quot;Longitude&quot;:41.951363216,&quot;Crimes&quot;:2},{&quot;Latitude&quot;:-87.66593671306251,&quot;Longitude&quot;:41.981684468156246,&quot;Crimes&quot;:6},{&quot;Latitude&quot;:-87.72403183470671,&quot;Longitude&quot;:41.85971017860585,&quot;Crimes&quot;:20},{&quot;Latitude&quot;:-87.62171438653125,&quot;Longitude&quot;:41.70872455540625,&quot;Crimes&quot;:6},{&quot;Latitude&quot;:-87.67966820851757,&quot;Longitude&quot;:41.9168965719668,&quot;Crimes&quot;:10},{&quot;Latitude&quot;:-87.678925614875,&quot;Longitude&quot;:41.920976203437505,&quot;Crimes&quot;:5},{&quot;Latitude&quot;:-87.6412522469397,&quot;Longitude&quot;:41.789962835152096,&quot;Crimes&quot;:13},{&quot;Latitude&quot;:-87.79397370717187,&quot;Longitude&quot;:41.92650627644531,&quot;Crimes&quot;:8},{&quot;Latitude&quot;:-87.54952956368749,&quot;Longitude&quot;:41.72249692,&quot;Crimes&quot;:5},{&quot;Latitude&quot;:-87.74630668456933,&quot;Longitude&quot;:41.90474763654053,&quot;Crimes&quot;:12},{&quot;Latitude&quot;:-87.6701250305,&quot;Longitude&quot;:42.0152216585,&quot;Crimes&quot;:4},{&quot;Latitude&quot;:-87.59461735310157,&quot;Longitude&quot;:41.80198657816406,&quot;Crimes&quot;:8},{&quot;Latitude&quot;:-87.72111497743751,&quot;Longitude&quot;:41.9833438615,&quot;Crimes&quot;:6},{&quot;Latitude&quot;:-87.69321636978125,&quot;Longitude&quot;:41.8302736925625,&quot;Crimes&quot;:9},{&quot;Latitude&quot;:-87.71900433837499,&quot;Longitude&quot;:41.779649904375006,&quot;Crimes&quot;:4},{&quot;Latitude&quot;:-87.71609095631251,&quot;Longitude&quot;:41.799912181187494,&quot;Crimes&quot;:6},{&quot;Latitude&quot;:-87.65674364529879,&quot;Longitude&quot;:41.739753430016435,&quot;Crimes&quot;:21},{&quot;Latitude&quot;:-87.6383606199575,&quot;Longitude&quot;:41.870289812769656,&quot;Crimes&quot;:28},{&quot;Latitude&quot;:-87.71072488825,&quot;Longitude&quot;:41.9930283045,&quot;Crimes&quot;:3},{&quot;Latitude&quot;:-87.7719679025,&quot;Longitude&quot;:41.97666197625,&quot;Crimes&quot;:4}],&quot;genId&quot;:&quot;1091742217&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/geoPointsChart'], \n      function(playground, _magicgeoPointsChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicgeoPointsChart,\n    \"o\": {\"lat\":\"Longitude\",\"lon\":\"Latitude\",\"width\":1000,\"height\":1000,\"rField\":\"Crimes\",\"colorField\":\"Crimes\",\"r\":\"Crimes\",\"color\":\"Crimes\"}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon8d8be3955b24f6b854e4c471e2ac8bac&quot;,&quot;initialValue&quot;:&quot;50&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon997cc1c75a350a3a3e14e846487ccb9a&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":3,"time":"Took: 13.745s, at 2019-01-15 15:23"}]},{"metadata":{"id":"3920A6CC82204F5C8AAFA39A9CD29CD5"},"cell_type":"markdown","source":"### Extract the most dangerous hours in the day in Chicago by analysing the number of crimes in time"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"E1386ECC18AF42498DA1BC11CBFBC38B"},"cell_type":"code","source":"object CrimeAnalyserByTime {\n  def CrimesByTime() :Array[org.apache.spark.sql.DataFrame] = {\n    \n    val session = SparkSession.builder().appName(\"Crime analyser by time\").master(\"local\").getOrCreate()\n    val data1 = session.read.format(\"csv\").option(\"header\", \"true\").load(\"/crimes.csv\")\n    val data = data1.drop()\n    \n    val dates = data.select(\"Date\").toDF(\"Date\")\n    val times = dates.map(date => date.getString(0).split(\" \")).map(date => date(1)\n                                                             .split(\":\")(0) + \" \" + date(2))\n    val months = dates.map(date => date.getString(0).split(\" \")(0).split(\"/\")(0)).rdd\n    val years = dates.map(date => date.getString(0).split(\" \")(0).split(\"/\")(2)).rdd\n    \n    val convertTime = (line:String) => { if(line.split(\" \")(1) == \"PM\") (line.split(\" \")(0).toInt + 12)\n                                      else line.split(\" \")(0).toInt }\n    \n    val timesInt = times.map(convertTime).rdd\n    \n    val crimesByHour = timesInt.map(hour => (hour, 1)).reduceByKey(_ + _).sortBy(-_._2).toDF(\"Hour\", \"Crimes\")\n    val crimesByMonth = months.map(month => (month, 1)).reduceByKey(_ + _).sortBy(_._1).toDF(\"Month\", \"Crimes\")\n    val crimesByYear = years.map(year => (year, 1)).reduceByKey(_ + _).sortBy(_._1).toDF(\"Year\", \"Crimes\")\n        \n    return Array(crimesByHour, crimesByMonth, crimesByYear)\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"defined object CrimeAnalyserByTime\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":72,"time":"Took: 0.949s, at 2019-01-17 19:39"}]},{"metadata":{"id":"7D5F1F59FF474116B85C1C95DBE14670"},"cell_type":"markdown","source":"### Plot a dynamic chart to demonstrate the danger degree in each hour during the day"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"presentation":{"pivot_chart_state":"{\n  \"hiddenAttributes\": [],\n  \"menuLimit\": 200,\n  \"cols\": [],\n  \"rows\": [\n    \"Hour\",\n    \"Crimes\"\n  ],\n  \"vals\": [\n    \"Crimes\"\n  ],\n  \"exclusions\": {},\n  \"inclusions\": {},\n  \"unusedAttrsVertical\": 85,\n  \"autoSortUnusedAttrs\": false,\n  \"inclusionsInfo\": {},\n  \"aggregatorName\": \"List Unique Values\",\n  \"rendererName\": \"Col Heatmap\"\n}"},"id":"CF26BB3386694A7785576D6904D08B78"},"cell_type":"code","source":"val proccessedData2 = CrimeAnalyserByTime.CrimesByTime()(0)\n// proccessedData2.show()\nval chart2 = PivotChart(proccessedData2)\nchart2\n","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData2: org.apache.spark.sql.DataFrame = [Hour: int, Crimes: int]\nchart2: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\nres126: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anonf87b6fc52064c09dce40da90fa6e9384&quot;,&quot;dataInit&quot;:[{&quot;Hour&quot;:24,&quot;Crimes&quot;:49},{&quot;Hour&quot;:16,&quot;Crimes&quot;:37},{&quot;Hour&quot;:9,&quot;Crimes&quot;:36},{&quot;Hour&quot;:15,&quot;Crimes&quot;:34},{&quot;Hour&quot;:10,&quot;Crimes&quot;:33},{&quot;Hour&quot;:13,&quot;Crimes&quot;:30},{&quot;Hour&quot;:11,&quot;Crimes&quot;:30},{&quot;Hour&quot;:14,&quot;Crimes&quot;:30},{&quot;Hour&quot;:8,&quot;Crimes&quot;:27},{&quot;Hour&quot;:7,&quot;Crimes&quot;:26},{&quot;Hour&quot;:21,&quot;Crimes&quot;:20},{&quot;Hour&quot;:22,&quot;Crimes&quot;:16},{&quot;Hour&quot;:23,&quot;Crimes&quot;:16},{&quot;Hour&quot;:12,&quot;Crimes&quot;:16},{&quot;Hour&quot;:1,&quot;Crimes&quot;:14},{&quot;Hour&quot;:17,&quot;Crimes&quot;:14},{&quot;Hour&quot;:2,&quot;Crimes&quot;:13},{&quot;Hour&quot;:6,&quot;Crimes&quot;:11},{&quot;Hour&quot;:19,&quot;Crimes&quot;:9},{&quot;Hour&quot;:3,&quot;Crimes&quot;:9},{&quot;Hour&quot;:18,&quot;Crimes&quot;:9},{&quot;Hour&quot;:5,&quot;Crimes&quot;:8},{&quot;Hour&quot;:20,&quot;Crimes&quot;:7},{&quot;Hour&quot;:4,&quot;Crimes&quot;:5}],&quot;genId&quot;:&quot;948921715&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pivotChart'], \n      function(playground, _magicpivotChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpivotChart,\n    \"o\": {\"width\":600,\"height\":400,\"derivedAttributes\":{},\"extraOptions\":{}}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anoncf9eb4e660af8f57169beaade61b4aaa&quot;,&quot;initialValue&quot;:&quot;24&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon9ab300ef352b10c04a057dccd8852205&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":73,"time":"Took: 1.223s, at 2019-01-17 19:39"}]},{"metadata":{"id":"43581C4BB0C24C8C81A7A3C8D9F6900B"},"cell_type":"markdown","source":"### Plot a dynamic chart to demonstrate the danger degree in each month in the year"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"presentation":{"pivot_chart_state":"{\n  \"hiddenAttributes\": [],\n  \"menuLimit\": 200,\n  \"cols\": [],\n  \"rows\": [\n    \"Month\",\n    \"Crimes\"\n  ],\n  \"vals\": [\n    \"Crimes\"\n  ],\n  \"exclusions\": {},\n  \"inclusions\": {},\n  \"unusedAttrsVertical\": 85,\n  \"autoSortUnusedAttrs\": false,\n  \"inclusionsInfo\": {},\n  \"aggregatorName\": \"List Unique Values\",\n  \"rendererName\": \"Col Heatmap\"\n}"},"id":"CF45844245B7429CA8C9CB6ECB14BCAF"},"cell_type":"code","source":"val proccessedData4 = CrimeAnalyserByTime.CrimesByTime()(1)\n// proccessedData4.show()\nval chart4 = PivotChart(proccessedData4)\nchart4","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData4: org.apache.spark.sql.DataFrame = [Month: string, Crimes: int]\nchart4: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\nres121: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon7f1ed200dc8a838a2914a3116ef61e3b&quot;,&quot;dataInit&quot;:[{&quot;Month&quot;:&quot;01&quot;,&quot;Crimes&quot;:323703},{&quot;Month&quot;:&quot;02&quot;,&quot;Crimes&quot;:285926},{&quot;Month&quot;:&quot;03&quot;,&quot;Crimes&quot;:353885},{&quot;Month&quot;:&quot;04&quot;,&quot;Crimes&quot;:355363},{&quot;Month&quot;:&quot;05&quot;,&quot;Crimes&quot;:383664},{&quot;Month&quot;:&quot;06&quot;,&quot;Crimes&quot;:381642},{&quot;Month&quot;:&quot;07&quot;,&quot;Crimes&quot;:376465},{&quot;Month&quot;:&quot;08&quot;,&quot;Crimes&quot;:343846},{&quot;Month&quot;:&quot;09&quot;,&quot;Crimes&quot;:316114},{&quot;Month&quot;:&quot;10&quot;,&quot;Crimes&quot;:319337},{&quot;Month&quot;:&quot;11&quot;,&quot;Crimes&quot;:287436},{&quot;Month&quot;:&quot;12&quot;,&quot;Crimes&quot;:272618}],&quot;genId&quot;:&quot;152462379&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pivotChart'], \n      function(playground, _magicpivotChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpivotChart,\n    \"o\": {\"width\":600,\"height\":400,\"derivedAttributes\":{},\"extraOptions\":{}}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonf2fe107fc081d3c561e9304d4872e31a&quot;,&quot;initialValue&quot;:&quot;12&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon7ced16cbfe52f5dd822788b168358652&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":70,"time":"Took: 27.798s, at 2019-01-17 19:31"}]},{"metadata":{"id":"67483D4696AF48D7BDC26E9C185AD85C"},"cell_type":"markdown","source":"### Plot a dynamic chart to demonstrate the danger degree evolution during the years"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"presentation":{"pivot_chart_state":"{\n  \"hiddenAttributes\": [],\n  \"menuLimit\": 200,\n  \"cols\": [],\n  \"rows\": [\n    \"Year\",\n    \"Crimes\"\n  ],\n  \"vals\": [\n    \"Crimes\"\n  ],\n  \"exclusions\": {},\n  \"inclusions\": {},\n  \"unusedAttrsVertical\": 85,\n  \"autoSortUnusedAttrs\": false,\n  \"inclusionsInfo\": {},\n  \"aggregatorName\": \"List Unique Values\",\n  \"rendererName\": \"Col Heatmap\"\n}"},"id":"27A1CF47B122495F8A2984CD95FCFAE6"},"cell_type":"code","source":"val proccessedData5 = CrimeAnalyserByTime.CrimesByTime()(2)\n// proccessedData5.show()\nval chart5 = PivotChart(proccessedData5)\nchart5","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData5: org.apache.spark.sql.DataFrame = [Year: string, Crimes: int]\nchart5: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\nres119: notebook.front.widgets.charts.PivotChart[org.apache.spark.sql.DataFrame] = <PivotChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anon971b8e8a2c54f6ad338bd0fca0b22965&quot;,&quot;dataInit&quot;:[{&quot;Year&quot;:&quot;2001&quot;,&quot;Crimes&quot;:485649},{&quot;Year&quot;:&quot;2002&quot;,&quot;Crimes&quot;:330693},{&quot;Year&quot;:&quot;2003&quot;,&quot;Crimes&quot;:108014},{&quot;Year&quot;:&quot;2004&quot;,&quot;Crimes&quot;:104524},{&quot;Year&quot;:&quot;2005&quot;,&quot;Crimes&quot;:102522},{&quot;Year&quot;:&quot;2006&quot;,&quot;Crimes&quot;:100716},{&quot;Year&quot;:&quot;2007&quot;,&quot;Crimes&quot;:96940},{&quot;Year&quot;:&quot;2008&quot;,&quot;Crimes&quot;:98751},{&quot;Year&quot;:&quot;2009&quot;,&quot;Crimes&quot;:91171},{&quot;Year&quot;:&quot;2010&quot;,&quot;Crimes&quot;:369518},{&quot;Year&quot;:&quot;2011&quot;,&quot;Crimes&quot;:350903},{&quot;Year&quot;:&quot;2012&quot;,&quot;Crimes&quot;:334874},{&quot;Year&quot;:&quot;2013&quot;,&quot;Crimes&quot;:306559},{&quot;Year&quot;:&quot;2014&quot;,&quot;Crimes&quot;:273332},{&quot;Year&quot;:&quot;2015&quot;,&quot;Crimes&quot;:258463},{&quot;Year&quot;:&quot;2016&quot;,&quot;Crimes&quot;:246247},{&quot;Year&quot;:&quot;2017&quot;,&quot;Crimes&quot;:215672},{&quot;Year&quot;:&quot;2018&quot;,&quot;Crimes&quot;:125451}],&quot;genId&quot;:&quot;177532762&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pivotChart'], \n      function(playground, _magicpivotChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpivotChart,\n    \"o\": {\"width\":600,\"height\":400,\"derivedAttributes\":{},\"extraOptions\":{}}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon571a3f70683d7a0bf1212b95feb027f2&quot;,&quot;initialValue&quot;:&quot;18&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonb06dbb48b06a1eb93d4c285e61ff91c4&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":69,"time":"Took: 35.297s, at 2019-01-17 19:30"}]},{"metadata":{"id":"FD1CDE0324CC43129B0E68AB0ECBF941"},"cell_type":"markdown","source":"### Extract the most efficient beats in terms of arresting criminals in Chicago City"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"ECFE6DCCF84C451C8BF3759D61A5015E"},"cell_type":"code","source":"object CrimeAnalyserBeatEfficency {\n  def BeatEfficency() :org.apache.spark.sql.DataFrame = {\n    \n    val session = SparkSession.builder().appName(\"Efficency of each beat in Chicago\").master(\"local\").getOrCreate()\n    val data = session.read.format(\"csv\").option(\"header\", \"true\").load(\"/crimes.csv\")\n\n    val arrestString = data.select(\"Arrest\").map(row => row.getString(0))\n    val arrestInt = arrestString.map(arrest => { if(arrest == \"true\") 1 else 0 } ).rdd\n\n    val beat = data.select(\"Beat\").map(row => row.getString(0)).rdd\n    val arrestByBeat = beat.zip(arrestInt)\n    val nbArrestByBeat = arrestByBeat.reduceByKey(_ + _).toDF(\"Beat\", \"Arrest\")\n    val totalByBeat = beat.map(beat => (beat, 1)).reduceByKey(_ + _).toDF(\"Beat\", \"Total crimes\")\n    \n    val beatArrestTotal = nbArrestByBeat.join(totalByBeat, Seq(\"Beat\"), \"inner\").orderBy(desc(\"Arrest\"))\n    \n    val beatRate = beatArrestTotal\n    .map(row => (row.getString(0), row.getInt(1), row.getInt(2), (row.getInt(1)*100/row.getInt(2)).toInt))\n    .toDF(\"Beat\", \"Arrest\", \"Total crimes\", \"Rate\")\n    \n    return beatRate\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"defined object CrimeAnalyserBeatEfficency\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":44,"time":"Took: 0.854s, at 2019-01-17 18:20"}]},{"metadata":{"id":"14BC395DC2634715812C0E6E1A7C16DE"},"cell_type":"markdown","source":"### Plot the rates of arrests made by each beat in the City of Chicago"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"presentation":{"pivot_chart_state":"{\n  \"hiddenAttributes\": [],\n  \"menuLimit\": 200,\n  \"cols\": [\n    \"Beat\"\n  ],\n  \"rows\": [\n    \"Rate\",\n    \"Arrest\"\n  ],\n  \"vals\": [\n    \"Rate\"\n  ],\n  \"exclusions\": {},\n  \"inclusions\": {},\n  \"unusedAttrsVertical\": 85,\n  \"autoSortUnusedAttrs\": false,\n  \"inclusionsInfo\": {},\n  \"aggregatorName\": \"Average\",\n  \"rendererName\": \"Line Chart\"\n}"},"id":"E145B8E923ED41E08CD73FAC8C9CD9A3"},"cell_type":"code","source":"val proccessedData3 = CrimeAnalyserBeatEfficency.BeatEfficency()\n// proccessedData3.show()\nval chart3 = BarChart(proccessedData3, fields = Some(\"Beat\", \"Rate\"), sizes = (800,600))\nchart3","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData3: org.apache.spark.sql.DataFrame = [Beat: string, Arrest: int ... 2 more fields]\nchart3: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\nres84: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anond7410c4bc028732f54f9150c8c4c3aa3&quot;,&quot;dataInit&quot;:[{&quot;Beat&quot;:&quot;1533&quot;,&quot;Rate&quot;:41},{&quot;Beat&quot;:&quot;1132&quot;,&quot;Rate&quot;:44},{&quot;Beat&quot;:&quot;1113&quot;,&quot;Rate&quot;:46},{&quot;Beat&quot;:&quot;1112&quot;,&quot;Rate&quot;:38},{&quot;Beat&quot;:&quot;1134&quot;,&quot;Rate&quot;:46},{&quot;Beat&quot;:&quot;1121&quot;,&quot;Rate&quot;:40},{&quot;Beat&quot;:&quot;1131&quot;,&quot;Rate&quot;:50},{&quot;Beat&quot;:&quot;1522&quot;,&quot;Rate&quot;:35},{&quot;Beat&quot;:&quot;1011&quot;,&quot;Rate&quot;:36},{&quot;Beat&quot;:&quot;1122&quot;,&quot;Rate&quot;:41},{&quot;Beat&quot;:&quot;0111&quot;,&quot;Rate&quot;:31},{&quot;Beat&quot;:&quot;1115&quot;,&quot;Rate&quot;:49},{&quot;Beat&quot;:&quot;1133&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;2533&quot;,&quot;Rate&quot;:33},{&quot;Beat&quot;:&quot;0421&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;1532&quot;,&quot;Rate&quot;:35},{&quot;Beat&quot;:&quot;0712&quot;,&quot;Rate&quot;:34},{&quot;Beat&quot;:&quot;0513&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;0621&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;0624&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;0423&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0713&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;0511&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1531&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;1021&quot;,&quot;Rate&quot;:33},{&quot;Beat&quot;:&quot;1833&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;0112&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0422&quot;,&quot;Rate&quot;:30},{&quot;Beat&quot;:&quot;2534&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;0623&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0622&quot;,&quot;Rate&quot;:35},{&quot;Beat&quot;:&quot;1834&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;0512&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0522&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;0723&quot;,&quot;Rate&quot;:31},{&quot;Beat&quot;:&quot;0725&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;0612&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0823&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0733&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;0632&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0312&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0735&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;0825&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;1135&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;0414&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1123&quot;,&quot;Rate&quot;:30},{&quot;Beat&quot;:&quot;0321&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1022&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;0832&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;1524&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;0611&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;2532&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0124&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;0833&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1924&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0631&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;2515&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;2422&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;1024&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0123&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0922&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0533&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0924&quot;,&quot;Rate&quot;:28},{&quot;Beat&quot;:&quot;1014&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;2512&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0424&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0613&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0734&quot;,&quot;Rate&quot;:31},{&quot;Beat&quot;:&quot;1523&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;0831&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;1831&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;2535&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0431&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1124&quot;,&quot;Rate&quot;:32},{&quot;Beat&quot;:&quot;0524&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;2521&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0531&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0411&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0711&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0824&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;2531&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;2234&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0331&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0131&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0523&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1914&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0634&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0323&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0731&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0912&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0432&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1013&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;1824&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1012&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0614&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0412&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0934&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;1114&quot;,&quot;Rate&quot;:34},{&quot;Beat&quot;:&quot;0324&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0724&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;0931&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;1111&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0726&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;1513&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;2223&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0732&quot;,&quot;Rate&quot;:26},{&quot;Beat&quot;:&quot;1913&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;2222&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1031&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0532&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0113&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0322&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0932&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;2413&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0933&quot;,&quot;Rate&quot;:27},{&quot;Beat&quot;:&quot;1233&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0714&quot;,&quot;Rate&quot;:29},{&quot;Beat&quot;:&quot;0332&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;0815&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0212&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;2232&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;1222&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;0822&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;1923&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0225&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;0921&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;0813&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1033&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;1034&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0313&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0835&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1821&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;1223&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1225&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1221&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0413&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;0834&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;0333&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1234&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1232&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;2221&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0915&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;1023&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0821&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;1423&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;1511&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;1633&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1722&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;2522&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0722&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;2023&quot;,&quot;Rate&quot;:29},{&quot;Beat&quot;:&quot;0223&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0133&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;1712&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1432&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;0715&quot;,&quot;Rate&quot;:24},{&quot;Beat&quot;:&quot;0211&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0231&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;2212&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;0923&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1723&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;2432&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;0122&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1424&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;2233&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;2514&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;0935&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1512&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0633&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1623&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1925&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1422&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;2011&quot;,&quot;Rate&quot;:18},{&quot;Beat&quot;:&quot;0913&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;0224&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;0114&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;0334&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;0314&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;0811&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;2412&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;2424&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;1822&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;0434&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;1832&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;0433&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1032&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;0311&quot;,&quot;Rate&quot;:19},{&quot;Beat&quot;:&quot;0911&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;1732&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;2525&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;1634&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;0925&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;0914&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1624&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1731&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;1622&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;1421&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;0213&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;0814&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;2524&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;2523&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;2213&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;2511&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;0121&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1412&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1915&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;1823&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1224&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;1211&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;0232&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1653&quot;,&quot;Rate&quot;:44},{&quot;Beat&quot;:&quot;2024&quot;,&quot;Rate&quot;:21},{&quot;Beat&quot;:&quot;2211&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1632&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1933&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1434&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;0132&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1713&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1934&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;1733&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;0222&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;2433&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1921&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1235&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1215&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1654&quot;,&quot;Rate&quot;:29},{&quot;Beat&quot;:&quot;1931&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;0234&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;2423&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1651&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;1231&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;0215&quot;,&quot;Rate&quot;:15},{&quot;Beat&quot;:&quot;1433&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;2033&quot;,&quot;Rate&quot;:23},{&quot;Beat&quot;:&quot;2411&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;0812&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;1631&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;0221&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;0214&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;1724&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;1125&quot;,&quot;Rate&quot;:22},{&quot;Beat&quot;:&quot;1711&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;2431&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1414&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;1411&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;2513&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1612&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;2031&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1212&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1812&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;1935&quot;,&quot;Rate&quot;:7},{&quot;Beat&quot;:&quot;2032&quot;,&quot;Rate&quot;:17},{&quot;Beat&quot;:&quot;1431&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;1912&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;2013&quot;,&quot;Rate&quot;:13},{&quot;Beat&quot;:&quot;1922&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1213&quot;,&quot;Rate&quot;:8},{&quot;Beat&quot;:&quot;1613&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;1811&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;2012&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1911&quot;,&quot;Rate&quot;:8},{&quot;Beat&quot;:&quot;1814&quot;,&quot;Rate&quot;:7},{&quot;Beat&quot;:&quot;1413&quot;,&quot;Rate&quot;:10},{&quot;Beat&quot;:&quot;1611&quot;,&quot;Rate&quot;:11},{&quot;Beat&quot;:&quot;1214&quot;,&quot;Rate&quot;:5},{&quot;Beat&quot;:&quot;2022&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;0233&quot;,&quot;Rate&quot;:8},{&quot;Beat&quot;:&quot;1932&quot;,&quot;Rate&quot;:8},{&quot;Beat&quot;:&quot;1614&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1621&quot;,&quot;Rate&quot;:12},{&quot;Beat&quot;:&quot;1655&quot;,&quot;Rate&quot;:49},{&quot;Beat&quot;:&quot;1652&quot;,&quot;Rate&quot;:49},{&quot;Beat&quot;:&quot;0235&quot;,&quot;Rate&quot;:7},{&quot;Beat&quot;:&quot;1813&quot;,&quot;Rate&quot;:6},{&quot;Beat&quot;:&quot;1311&quot;,&quot;Rate&quot;:50},{&quot;Beat&quot;:&quot;2113&quot;,&quot;Rate&quot;:50},{&quot;Beat&quot;:&quot;2323&quot;,&quot;Rate&quot;:33},{&quot;Beat&quot;:&quot;2324&quot;,&quot;Rate&quot;:66},{&quot;Beat&quot;:&quot;2122&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1332&quot;,&quot;Rate&quot;:50},{&quot;Beat&quot;:&quot;2332&quot;,&quot;Rate&quot;:20},{&quot;Beat&quot;:&quot;2312&quot;,&quot;Rate&quot;:40},{&quot;Beat&quot;:&quot;2112&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;2322&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;1331&quot;,&quot;Rate&quot;:25},{&quot;Beat&quot;:&quot;2132&quot;,&quot;Rate&quot;:9},{&quot;Beat&quot;:&quot;1313&quot;,&quot;Rate&quot;:16},{&quot;Beat&quot;:&quot;1324&quot;,&quot;Rate&quot;:14},{&quot;Beat&quot;:&quot;2111&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2131&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;1322&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2123&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;0134&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;1323&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2311&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;1312&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2133&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2333&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2124&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;2313&quot;,&quot;Rate&quot;:0},{&quot;Beat&quot;:&quot;1333&quot;,&quot;Rate&quot;:0}],&quot;genId&quot;:&quot;1956097046&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"Beat\",\"y\":\"Rate\",\"width\":800,\"height\":600}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon24f2fc2620e3cce12f8a341bf83c3d49&quot;,&quot;initialValue&quot;:&quot;301&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon89243d9ab6ad219ddd05ee8d05b1094d&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":47,"time":"Took: 5.332s, at 2019-01-17 18:23"}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true,"id":"5D238282593048D48C5041AF640EF0FB"},"cell_type":"markdown","source":"### Extract the most efficient districs in terms of arresting criminals in Chicago City"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"03E77EA4B4EC460681550F413F43137B"},"cell_type":"code","source":"object DistrictEfficency {\n  def DistrictEfficency() :org.apache.spark.sql.DataFrame = {\n    \n    val session = SparkSession.builder().appName(\"Efficency of each district in Chicago\").master(\"local\").getOrCreate()\n    val data = session.read.format(\"csv\").option(\"header\", \"true\").load(\"/crimes.csv\")\n\n    val arrestString = data.select(\"Arrest\").map(row => row.getString(0))\n    val arrestInt = arrestString.map(arrest => { if(arrest == \"true\") 1 else 0 } ).rdd\n\n    val district = data.select(\"District\").map(row => row.getString(0)).rdd\n    val arrestByDistrict = district.zip(arrestInt)\n    val nbArrestByDistrict = arrestByDistrict.reduceByKey(_ + _).toDF(\"District\", \"Arrest\")\n    val totalByDistrict = district.map(district => (district, 1)).reduceByKey(_ + _).toDF(\"District\", \"Total crimes\")\n    \n    val districtArrestTotal = nbArrestByDistrict.join(totalByDistrict, Seq(\"District\"), \"inner\").orderBy(desc(\"Arrest\"))\n    \n    val districtRate = districtArrestTotal\n    .map(row => (row.getString(0), row.getInt(1), row.getInt(2), (row.getInt(1)*100/row.getInt(2)).toInt))\n    .toDF(\"District\", \"Arrest\", \"Total crimes\", \"Rate\")\n    \n    return districtRate\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"defined object DistrictEfficency\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":4,"time":"Took: 0.735s, at 2019-01-17 20:08"}]},{"metadata":{"id":"127D6194CAE749FF8C6B340A9AFE9171"},"cell_type":"markdown","source":"### Plot the rates of arrests made in each district in the City of Chicago"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"F89AB9DCE2BC460B8E8DE052890A2581"},"cell_type":"code","source":"val proccessedData6 = DistrictEfficency.DistrictEfficency()\n// proccessedData6.show()\nval chart6 = BarChart(proccessedData6, fields = Some(\"District\", \"Rate\"), sizes = (800,600))\nchart6","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData6: org.apache.spark.sql.DataFrame = [District: string, Arrest: int ... 2 more fields]\nchart6: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\nres136: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anonb4b3021a8514ecdc4dc45ad720b63d78&quot;,&quot;dataInit&quot;:[{&quot;District&quot;:&quot;011&quot;,&quot;Rate&quot;:39},{&quot;District&quot;:&quot;007&quot;,&quot;Rate&quot;:27},{&quot;District&quot;:&quot;006&quot;,&quot;Rate&quot;:24},{&quot;District&quot;:&quot;015&quot;,&quot;Rate&quot;:32},{&quot;District&quot;:&quot;010&quot;,&quot;Rate&quot;:28},{&quot;District&quot;:&quot;025&quot;,&quot;Rate&quot;:23},{&quot;District&quot;:&quot;008&quot;,&quot;Rate&quot;:19},{&quot;District&quot;:&quot;004&quot;,&quot;Rate&quot;:21},{&quot;District&quot;:&quot;005&quot;,&quot;Rate&quot;:24},{&quot;District&quot;:&quot;009&quot;,&quot;Rate&quot;:23},{&quot;District&quot;:&quot;003&quot;,&quot;Rate&quot;:21},{&quot;District&quot;:&quot;001&quot;,&quot;Rate&quot;:20},{&quot;District&quot;:&quot;002&quot;,&quot;Rate&quot;:19},{&quot;District&quot;:&quot;018&quot;,&quot;Rate&quot;:18},{&quot;District&quot;:&quot;012&quot;,&quot;Rate&quot;:17},{&quot;District&quot;:&quot;019&quot;,&quot;Rate&quot;:17},{&quot;District&quot;:&quot;022&quot;,&quot;Rate&quot;:18},{&quot;District&quot;:&quot;014&quot;,&quot;Rate&quot;:15},{&quot;District&quot;:&quot;016&quot;,&quot;Rate&quot;:16},{&quot;District&quot;:&quot;024&quot;,&quot;Rate&quot;:18},{&quot;District&quot;:&quot;017&quot;,&quot;Rate&quot;:15},{&quot;District&quot;:&quot;020&quot;,&quot;Rate&quot;:20},{&quot;District&quot;:&quot;031&quot;,&quot;Rate&quot;:44}],&quot;genId&quot;:&quot;1658978210&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"District\",\"y\":\"Rate\",\"width\":800,\"height\":600}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonb1a0be17336e7e707924254e906186fb&quot;,&quot;initialValue&quot;:&quot;23&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anondf8be5fcc833410aed60a03b16ba5b4c&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":6,"time":"Took: 6.759s, at 2019-01-17 20:09"}]},{"metadata":{"id":"6101E01D1AEA4D48ABBC05B9FA1B6992"},"cell_type":"markdown","source":"### Extract the most efficient districs in terms of arresting criminals in Chicago City"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"E8E6D90325F54CB487C1B86FF06C15EF"},"cell_type":"code","source":"object WardEfficency {\n  def WardEfficency() :org.apache.spark.sql.DataFrame = {\n    \n    val session = SparkSession.builder().appName(\"Efficency of each ward in Chicago\").master(\"local\").getOrCreate()\n    val data = session.read.format(\"csv\").option(\"header\", \"true\").load(\"/crimes.csv\")\n\n    val arrestString = data.select(\"Arrest\").map(row => row.getString(0))\n    val arrestInt = arrestString.map(arrest => { if(arrest == \"true\") 1 else 0 } ).rdd\n\n    val ward = data.select(\"Ward\").map(row => row.getString(0)).rdd\n    val arrestByWard = ward.zip(arrestInt)\n    val nbArrestByWard = arrestByWard.reduceByKey(_ + _).toDF(\"Ward\", \"Arrest\")\n    val totalByWard = ward.map(ward => (ward, 1)).reduceByKey(_ + _).toDF(\"Ward\", \"Total crimes\")\n    \n    val wardArrestTotal = nbArrestByWard.join(totalByWard, Seq(\"Ward\"), \"inner\").orderBy(desc(\"Arrest\"))\n    \n    val wardRate = wardArrestTotal\n    .map(row => (row.getString(0), row.getInt(1), row.getInt(2), (row.getInt(1)*100/row.getInt(2)).toInt))\n    .toDF(\"Ward\", \"Arrest\", \"Total crimes\", \"Rate\")\n    \n    return wardRate\n  }\n}","outputs":[{"name":"stdout","output_type":"stream","text":"defined object WardEfficency\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":8,"time":"Took: 0.828s, at 2019-01-17 20:30"}]},{"metadata":{"id":"48FC3978DCF0430F978C8D93C9BC9098"},"cell_type":"markdown","source":"### Plot the rates of arrests made in each ward in the City of Chicago"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"0AEBF7B2AE3D4FF49FEA8F4DE1F81849"},"cell_type":"code","source":"val proccessedData7 = WardEfficency.WardEfficency()\n// proccessedData7.show()\nval chart7 = BarChart(proccessedData7, fields = Some(\"Ward\", \"Rate\"), sizes = (800,600))\nchart7","outputs":[{"name":"stdout","output_type":"stream","text":"proccessedData7: org.apache.spark.sql.DataFrame = [Ward: string, Arrest: int ... 2 more fields]\nchart7: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\nres141: notebook.front.widgets.charts.BarChart[org.apache.spark.sql.DataFrame] = <BarChart widget>\n"},{"metadata":{},"data":{"text/html":"<div>\n      <script data-this=\"{&quot;dataId&quot;:&quot;anonf60160277dd08fe80549bbce1f947215&quot;,&quot;dataInit&quot;:[{&quot;Ward&quot;:&quot;28&quot;,&quot;Rate&quot;:37},{&quot;Ward&quot;:&quot;24&quot;,&quot;Rate&quot;:37},{&quot;Ward&quot;:&quot;27&quot;,&quot;Rate&quot;:28},{&quot;Ward&quot;:&quot;42&quot;,&quot;Rate&quot;:18},{&quot;Ward&quot;:&quot;2&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;17&quot;,&quot;Rate&quot;:26},{&quot;Ward&quot;:&quot;16&quot;,&quot;Rate&quot;:28},{&quot;Ward&quot;:&quot;6&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;21&quot;,&quot;Rate&quot;:23},{&quot;Ward&quot;:&quot;3&quot;,&quot;Rate&quot;:25},{&quot;Ward&quot;:&quot;37&quot;,&quot;Rate&quot;:28},{&quot;Ward&quot;:&quot;20&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;9&quot;,&quot;Rate&quot;:25},{&quot;Ward&quot;:&quot;15&quot;,&quot;Rate&quot;:24},{&quot;Ward&quot;:&quot;34&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;7&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;29&quot;,&quot;Rate&quot;:24},{&quot;Ward&quot;:&quot;8&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;5&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;10&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;4&quot;,&quot;Rate&quot;:16},{&quot;Ward&quot;:&quot;1&quot;,&quot;Rate&quot;:15},{&quot;Ward&quot;:&quot;46&quot;,&quot;Rate&quot;:23},{&quot;Ward&quot;:&quot;26&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;49&quot;,&quot;Rate&quot;:20},{&quot;Ward&quot;:&quot;12&quot;,&quot;Rate&quot;:22},{&quot;Ward&quot;:&quot;22&quot;,&quot;Rate&quot;:23},{&quot;Ward&quot;:&quot;14&quot;,&quot;Rate&quot;:20},{&quot;Ward&quot;:&quot;18&quot;,&quot;Rate&quot;:16},{&quot;Ward&quot;:&quot;44&quot;,&quot;Rate&quot;:18},{&quot;Ward&quot;:&quot;31&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;30&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;25&quot;,&quot;Rate&quot;:18},{&quot;Ward&quot;:&quot;11&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;13&quot;,&quot;Rate&quot;:17},{&quot;Ward&quot;:&quot;23&quot;,&quot;Rate&quot;:17},{&quot;Ward&quot;:&quot;41&quot;,&quot;Rate&quot;:19},{&quot;Ward&quot;:&quot;32&quot;,&quot;Rate&quot;:12},{&quot;Ward&quot;:&quot;48&quot;,&quot;Rate&quot;:21},{&quot;Ward&quot;:&quot;35&quot;,&quot;Rate&quot;:15},{&quot;Ward&quot;:&quot;38&quot;,&quot;Rate&quot;:16},{&quot;Ward&quot;:&quot;40&quot;,&quot;Rate&quot;:16},{&quot;Ward&quot;:&quot;45&quot;,&quot;Rate&quot;:15},{&quot;Ward&quot;:&quot;36&quot;,&quot;Rate&quot;:15},{&quot;Ward&quot;:&quot;50&quot;,&quot;Rate&quot;:14},{&quot;Ward&quot;:&quot;33&quot;,&quot;Rate&quot;:14},{&quot;Ward&quot;:&quot;43&quot;,&quot;Rate&quot;:10},{&quot;Ward&quot;:&quot;39&quot;,&quot;Rate&quot;:13},{&quot;Ward&quot;:&quot;47&quot;,&quot;Rate&quot;:13},{&quot;Ward&quot;:&quot;19&quot;,&quot;Rate&quot;:13}],&quot;genId&quot;:&quot;616445038&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"Ward\",\"y\":\"Rate\",\"width\":800,\"height\":600}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script>\n    <div>\n      <span class=\"chart-total-item-count\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anonabb9f020af78b1eface44ef850e86d6c&quot;,&quot;initialValue&quot;:&quot;50&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p> entries total</span>\n      <span class=\"chart-sampling-warning\"><p data-bind=\"text: value\"><script data-this=\"{&quot;valueId&quot;:&quot;anon36c19aa7bbd7acc898848558c7289199&quot;,&quot;initialValue&quot;:&quot;&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/\nreq(\n['observable', 'knockout'],\nfunction (O, ko) {\n  ko.applyBindings({\n      value: O.makeObservable(valueId, initialValue)\n    },\n    this\n  );\n});\n        /*]]>*/</script></p></span>\n      <div>\n      </div>\n    </div></div>"},"output_type":"execute_result","execution_count":9,"time":"Took: 6.768s, at 2019-01-17 20:30"}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true,"id":"9B759B769F5046548B68E09B26963DCE"},"cell_type":"code","source":"","outputs":[]}],"nbformat":4}